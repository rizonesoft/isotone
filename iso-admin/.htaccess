# Isotone - Admin Directory Security
# Safe security measures for the admin area

# ============================================================================
# BASIC SECURITY
# ============================================================================

# Disable directory browsing
Options -Indexes

# ============================================================================
# CUSTOM ERROR PAGES
# ============================================================================

# Custom 404 error page
ErrorDocument 404 /isotone/iso-admin/404.php
ErrorDocument 403 /isotone/iso-admin/404.php

# ============================================================================
# PROTECT SENSITIVE AREAS
# ============================================================================

<IfModule mod_rewrite.c>
    RewriteEngine On
    
    # Protect includes directory from direct access
    RewriteRule ^includes/ - [F,L]
    
    # Protect cache/temp directories if they exist
    RewriteRule ^(cache|temp|tmp)/ - [F,L]
</IfModule>

# ============================================================================
# PROTECT SENSITIVE FILES
# ============================================================================

# Protect backup and log files
<FilesMatch "\.(log|bak|backup|sql|old|orig|original|txt~|php~|ini|inc)$">
    <IfModule mod_authz_core.c>
        Require all denied
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order allow,deny
        Deny from all
    </IfModule>
</FilesMatch>

# Protect configuration files (but allow settings.php which is a valid admin page)
<FilesMatch "^(config|configuration)\.(php|ini|json)$">
    <IfModule mod_authz_core.c>
        Require all denied
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order allow,deny
        Deny from all
    </IfModule>
</FilesMatch>

# ============================================================================
# OPTIONAL: IP-BASED RESTRICTION (Uncomment to use)
# ============================================================================
# Restrict admin access to specific IP addresses
# Replace xxx.xxx.xxx.xxx with your actual IP address
#
# <RequireAll>
#     <IfModule mod_authz_core.c>
#         Require ip 127.0.0.1
#         Require ip ::1
#         # Require ip xxx.xxx.xxx.xxx
#     </IfModule>
# </RequireAll>
#
# For Apache 2.2:
# <IfModule !mod_authz_core.c>
#     Order deny,allow
#     Deny from all
#     Allow from 127.0.0.1
#     Allow from ::1
#     # Allow from xxx.xxx.xxx.xxx
# </IfModule>

# ============================================================================
# OPTIONAL: PASSWORD PROTECTION (Uncomment to use)
# ============================================================================
# Add an extra layer of password protection to admin area
# You'll need to create a .htpasswd file first
#
# AuthType Basic
# AuthName "Admin Area - Restricted Access"
# AuthUserFile /path/to/your/.htpasswd
# Require valid-user

# ============================================================================
# ADMIN-SPECIFIC HEADERS
# ============================================================================
<IfModule mod_headers.c>
    # Prevent caching of sensitive admin pages
    Header set Cache-Control "no-cache, no-store, must-revalidate, private"
    Header set Pragma "no-cache"
    Header set Expires "0"
    
    # Additional security for admin area
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Frame-Options "DENY"
</IfModule>

# ============================================================================
# NOTES
# ============================================================================
# This .htaccess provides basic security for the admin directory
# without breaking functionality. Additional measures can be enabled:
#
# 1. IP restriction - limit access to specific IP addresses
# 2. Password protection - add HTTP Basic Authentication
# 3. SSL requirement - force HTTPS for admin area (configure in PHP)
#
# Always test changes before deploying to production
# ============================================================================